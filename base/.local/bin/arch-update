#!/bin/zsh

get_updates() {
  ARCHUPDATES="$(checkupdates)"
  AURUPDATES="$(yaourt -Qua)"
  if [ -n "$ARCHUPDATES" ]; then
    echo -nE "\\Z2\Zb${ARCHUPDATES}\\n"
  fi
  if [ -n "$AURUPDATES" ]; then
    echo -nE "\\Z1\Zb${AURUPDATES}\\n"
  fi
  if [ -n "$ARCHUPDATES" -o -n "$AURUPDATES" ]; then
    echo -nE "\\Zn"
  fi
}

if [ "$BLOCK_BUTTON" = "3" ]; then
  # right-click for upgrade
  UPDATES="$(get_updates)"
  if [ -n "$UPDATES" ]; then
    i3-sensible-terminal -e "zsh -ic 'dialog --title \"Updates\" --colors --yesno \"$(echo $UPDATES | paste -sd '|' | sed 's/|/\\\\n/g')Update packages?\" 0 0 && clear && yaourt -Syua && deorphan && yaourt -Scc'"
  fi
elif [ -z "$BLOCK_BUTTON" ]; then
  # wait 10s on login/reload
  sleep 10
fi
# check for upgradable packages
arch-update.py -a -u '#99734d'
